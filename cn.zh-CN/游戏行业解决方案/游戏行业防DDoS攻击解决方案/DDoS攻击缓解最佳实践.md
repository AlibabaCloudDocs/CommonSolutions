# DDoS攻击缓解最佳实践 {#concept_vjz_gyy_bgb .concept}

目前，有效缓解DDoS攻击的方法可分为 3 大类：

-   架构优化
-   服务器加固
-   商用的DDoS防护服务

## 架构优化 {#section_p5j_mzy_bgb .section}

在预算有限的情况下，建议您优先从自身架构的优化和服务器加固上下功夫，减缓DDoS攻击造成的影响。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/15075/154451972234057_zh-CN.png)

-   **部署DNS智能解析**

    通过智能解析的方式优化DNS解析，有效避免DNS流量攻击产生的风险。同时，建议您托管多家DNS服务商。

    -   屏蔽未经请求发送的DNS响应信息

        典型的DNS交换信息是由请求信息组成的。DNS解析器会将用户的请求信息发送至DNS服务器中，在DNS服务器对查询请求进行处理之后，服务器会将响应信息返回给DNS解析器。

        但值得注意的是，响应信息是不会主动发送的。服务器在没有接收到查询请求之前，就已经生成了对应的响应信息，这些回应就应被丢弃。

    -   丢弃快速重传数据包

        即便是在数据包丢失的情况下，任何合法的DNS客户端都不会在较短的时间间隔内向同一DNS服务器发送相同的DNS查询请求。如果从相同IP地址发送至同一目标地址的相同查询请求发送频率过高，这些请求数据包可被丢弃。

    -   启用TTL

        如果DNS服务器已经将响应信息成功发送了，应该禁止服务器在较短的时间间隔内对相同的查询请求信息进行响应。

        对于一个合法的DNS客户端，如果已经接收到了响应信息，就不会再次发送相同的查询请求。每一个响应信息都应进行缓存处理直到TTL过期。当DNS服务器遭遇大量查询请求时，可以屏蔽掉不需要的数据包。

    -   丢弃未知来源的DNS查询请求和响应数据

        通常情况下，攻击者会利用脚本对目标进行分布式拒绝服务攻击（DDoS攻击），而且这些脚本通常是有漏洞的。因此，在服务器中部署简单的匿名检测机制，在某种程度上可以限制传入服务器的数据包数量。

    -   丢弃未经请求或突发的DNS请求

        这类请求信息很可能是由伪造的代理服务器所发送的，或是由于客户端配置错误或者是攻击流量。无论是哪一种情况，都应该直接丢弃这类数据包。

        非泛洪攻击 \(non-flood\) 时段，可以创建一个白名单，添加允许服务器处理的合法请求信息。白名单可以屏蔽掉非法的查询请求信息以及此前从未见过的数据包。

        这种方法能够有效地保护服务器不受泛洪攻击的威胁，也能保证合法的域名服务器只对合法的DNS查询请求进行处理和响应。

    -   启动DNS客户端验证

        伪造是DNS攻击中常用的一种技术。如果设备可以启动客户端验证信任状，便可以用于从伪造泛洪数据中筛选出非泛洪数据包。

    -   对响应信息进行缓存处理

        如果某一查询请求对应的响应信息已经存在于服务器的DNS缓存之中，缓存可以直接对请求进行处理。这样可以有效地防止服务器因过载而发生宕机。

    -   使用ACL的权限

        很多请求中包含了服务器不具有或不支持的信息，可以进行简单的阻断设置。例如，外部IP地址请求区域转换或碎片化数据包，直接将这类请求数据包丢弃。

    -   利用ACL，BCP38及IP信誉功能

        托管DNS服务器的任何企业都有用户轨迹的限制，当攻击数据包被伪造，伪造请求来自世界各地的源地址。设置一个简单的过滤器可阻断不需要的地理位置的IP地址请求或只允许在地理位置白名单内的IP请求。

        同时，也存在某些伪造的数据包可能来自与内部网络地址的情况，可以利用BCP38通过硬件过滤清除异常来源地址的请求。

-   **部署负载均衡**

    通过部署负载均衡（SLB）服务器有效减缓CC攻击的影响。通过在SLB后端负载多台服务器的方式，对DDoS攻击中的CC攻击进行防护。

    部署负载均衡方案后，不仅具有CC攻击防护的作用，也能将访问用户均衡分配到各个服务器上，减少单台服务器的负担，加快访问速度。

-   **使用专有网络**

    通过网络内部逻辑隔离，防止来自内网肉鸡的攻击。

-   **提供余量带宽**

    通过服务器性能测试，评估正常业务环境下能承受的带宽和请求数，确保流量通道不止是日常的量，有一定的带宽余量可以有利于处理大规模攻击。


## 服务器加固 {#section_wbd_nzy_bgb .section}

在服务器上进行安全加固，减少可被攻击的点，增大攻击方的攻击成本：

-   确保服务器的系统文件是最新的版本，并及时更新系统补丁。
-   对所有服务器主机进行检查，清楚访问者的来源。
-   过滤不必要的服务和端口。例如，**WWW**服务器，只开放80端口，将其他所有端口关闭，或在防火墙上做阻止策略。
-   限制同时打开的SYN半连接数目，缩短SYN半连接的timeout时间，限制SYN/ICMP流量。
-   仔细检查网络设备和服务器系统的日志。一旦出现漏洞或是时间变更，则说明服务器可能遭到了攻击。
-   限制在防火墙外与网络文件共享。降低黑客截取系统文件的机会，若黑客以特洛伊木马替换它，文件传输功能无疑会陷入瘫痪。
-   充分利用网络设备保护网络资源。在配置路由器时应考虑以下策略的配置：流控、包过滤、半连接超时、垃圾包丢弃，来源伪造的数据包丢弃，SYN 阀值，禁用ICMP和UDP广播。
-   通过iptable之类的软件防火墙限制疑似恶意IP的TCP新建连接，限制疑似恶意IP的连接、传输速率。
-   识别游戏特征，自动将不符合游戏特征的连接断开。
-   防止空连接和假人攻击，将空连接的IP地址直接加入黑名单。
-   配置学习机制，保护游戏在线玩家不掉线。例如，通过服务器搜集正常玩家的信息，当面对攻击时，将正常玩家导入预先准备的服务器，并暂时放弃新进玩家的接入，以保障在线玩家的游戏体验。

## 商用的DDoS防护服务 {#section_l3q_nzy_bgb .section}

针对超大流量的攻击或者复杂的游戏CC攻击，可以考虑采用专业的DDoS解决方案。目前，通用的游戏行业安全解决方案做法是在IDC机房前端部署防火墙或者流量清洗的一些设备，或者采用大带宽的高防机房来清洗攻击。

当宽带资源充足时，此技术模式的确是防御游戏行业DDoS攻击的有效方式。不过带宽资源有时也会成为瓶颈：例如单点的IDC很容易被打满，对游戏公司本身的成本要求也比较高。

您可根据自己的预算和遭受攻击的严重程度，来决定采用哪些安全措施。

